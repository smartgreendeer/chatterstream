{% extends "base.html" %}
{% block content %}

<h1>Welcome to Life Mastery</h1>

<h2>Posts from people you follow</h2>

{% for post in posts %}
    <div class="post">
        <h3>{{ post.title }}</h3>
        {% if post.image %}
            <img src="{{ url_for('static', filename='uploads/' + post.image) }}" alt="Post image" class="post-image">
        {% endif %}
        <p>{{ post.content }}</p>
        <div class="post-meta">
            Posted by: <a href="{{ url_for('profile', username=post.author.username) }}">{{ post.author.username }}</a>
            on {{ post.date_posted.strftime('%Y-%m-%d %H:%M') }}
        </div>
        <div class="post-actions">
            {% if current_user.id in post.likes|map(attribute='user_id')|list %}
                <a href="{{ url_for('like', post_id=post.id) }}">Unlikeüíî</a>
            {% else %}
                <a href="{{ url_for('like', post_id=post.id) }}">Like‚ù§Ô∏è</a>
            {% endif %}
            <span>{{ post.likes|length }} likes</span>
        </div>
        <div class="comments">
            {% for comment in post.comments %}
                <div class="comment">
                    <p>{{ comment.content }}</p>
                    <small>{{ comment.author.username }} - {{ comment.date_posted.strftime('%Y-%m-%d %H:%M') }}</small>
                    {% if comment.author == current_user %}
                        <a href="{{ url_for('delete_comment', comment_id=comment.id) }}">Delete</a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <form action="{{ url_for('comment', post_id=post.id) }}" method="post">
            <input type="text" name="content" placeholder="Add a comment">
            <button type="submit">Comment</button>
        </form>
    </div>
{% else %}
    <p>No posts from followed users yet.</p>
{% endfor %}

<!-- Pagination -->
{% if page.has_prev %}
    <a href="{{ url_for('home', page=page.prev_num) }}">Previous</a>
{% endif %}
{% if page.has_next %}
    <a href="{{ url_for('home', page=page.next_num) }}">Next</a>
{% endif %}

<h2>Suggested Posts</h2>

{% for post in suggested_posts %}
    <div class="post">
        <h3>{{ post.title }}</h3>
        {% if post.image %}
            <img src="{{ url_for('static', filename='uploads/' + post.image) }}" alt="Post image" class="post-image">
        {% endif %}
        <p>{{ post.content }}</p>
        <div class="post-meta">
            Posted by: <a href="{{ url_for('profile', username=post.author.username) }}">{{ post.author.username }}</a>
            on {{ post.date_posted.strftime('%Y-%m-%d %H:%M') }}
        </div>
        <div class="post-actions">
            {% if current_user.id in post.likes|map(attribute='user_id')|list %}
                <a href="{{ url_for('like', post_id=post.id) }}">Unlikeüíî</a>
            {% else %}
                <a href="{{ url_for('like', post_id=post.id) }}">Like‚ù§Ô∏è</a>
            {% endif %}
            <span>{{ post.likes|length }} likes</span>
        </div>
    </div>
{% else %}
    <p>No suggested posts available.</p>
{% endfor %}

{% endblock %}